server:
  port: ${SERVER_PORT:8080}
  
# ============================================================================
# MANAGEMENT ENDPOINTS - Spring Boot Actuator (para VS Code Dashboard)
# ============================================================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,env,configprops,beans,mappings,threaddump,heapdump
  endpoint:
    health:
      show-details: always
      show-components: always
  metrics:
    enable:
      jvm: true
      process: true
      system: true

spring:
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USER:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    virtual-host: /
    exchange: ${RABBITMQ_EXCHANGE:netnotify_topic}
    queue: ${RABBITMQ_QUEUE:notification_queue}
    routing-key: ${RABBITMQ_ROUTING_KEY:notification_key}
    exchange-durable: ${RABBITMQ_EXCHANGE_DURABLE:true}

  profiles:
    include:
    - keycloak

  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5432}/${POSTGRES_DB:netnotify}
    username: ${POSTGRES_USER:postgres}
    password: ${POSTGRES_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver

  jpa:
    properties:
      hibernate:
        format_sql: true

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_PROVIDER_ISSUER:https://keycloak.derpb.com.br/realms/testes}
    
app:
  timezone: ${APP_TIMEZONE:America/Recife} # Timezone da aplicação, usado para datas e horários
  react-app-url: ${REACT_APP_URL:http://localhost:3000} # URL do app React que receberá a autenticação
  allowed-origins: ${ALLOWED_ORIGINS:http://localhost:5173,http://localhost:3000}
  keycloak:
    client-id: ${KEYCLOAK_CLIENT_ID:netnotify-client}
    client-secret: ${KEYCLOAK_CLIENT_SECRET:secret}
    # Token URL - IMPORTANT: Modern Keycloak (v20+) uses /realms path (NOT /auth/realms)
    # v17 e anteriores: https://keycloak.server/auth/realms/{realm}/protocol/openid-connect/token
    # v20+: https://keycloak.server/realms/{realm}/protocol/openid-connect/token
    token-url: ${KEYCLOAK_TOKEN_URL:https://seudominio.com.br/realms/testes/protocol/openid-connect/token}
    # Redirect URI que deve corresponder EXATAMENTE ao registrado no Keycloak Admin Console
    # Valid Redirect URIs: http://localhost:5173/callback ou outro conforme configurado no Keycloak
    redirect-uri: ${KEYCLOAK_REDIRECT_URI:http://localhost:5173/callback}  
    roles:
      admin: ${ROLE_ADMIN:NETNOTIFY_ADMIN}
      user: ${ROLE_USER:NETNOTIFY_USER}      
  jwt:
    secret: ${JWT_SECRET:myjwtsecretkey}
    expiration: ${JWT_EXPIRATION:3600000} # 1 hora

# Debug logging para OAuth2/JWT
logging:
  level:
    org.springframework.security: DEBUG
    org.springframework.security.oauth2: DEBUG
    org.springframework.security.oauth2.jwt: DEBUG
    org.springframework.security.oauth2.server.resource: DEBUG

